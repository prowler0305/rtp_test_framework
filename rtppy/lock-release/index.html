<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Lock Release - Real Time Performance Test Suite</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Real Time Performance Test Suite</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Introduction</a>
                    </li>
                    <li >
                        <a href="../../getting-started/">Getting Started</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">RTPJ <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../rtpj/build-instructions/">Build Instructions</a>
</li>
                            
<li >
    <a href="../../rtpj/running-tests/">Running Tests</a>
</li>
                            
<li >
    <a href="../../rtpj/test-tracker/">Tracking Results</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Creating Tests</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../rtpj/writing-tests/">Writing Tests</a>
</li>
            
<li >
    <a href="../../rtpj/json/single-file-tests/">JSON - Single File Tests</a>
</li>
            
<li >
    <a href="../../rtpj/json/test-suites/">JSON - Test Suites</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">RTPPY <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../introduction/">Introduction</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Running Tests</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../executing-tests/">Executing</a>
</li>
            
<li >
    <a href="../execute-jenkins/">Execute via Jenkins</a>
</li>
            
<li >
    <a href="../execute-intellij/">Execute via Intellij</a>
</li>
            
<li >
    <a href="../command-line-options/">Command Line Options</a>
</li>
            
<li >
    <a href="../json-parameters/">JSON Parameters</a>
</li>
            
<li >
    <a href="../creating-tests/">Creating Tests</a>
</li>
            
<li >
    <a href="../jenkins-output/">Viewing Output on Jenkins</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Test Types</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../interval-compare/">Interval Compare</a>
</li>
            
<li >
    <a href="../aggregate-compare/">Aggregate Compare</a>
</li>
            
<li >
    <a href="../start-collection/">Start/Stop Collection</a>
</li>
            
<li >
    <a href="../rtptest/">RTP Test Suite App</a>
</li>
            
<li >
    <a href="../abend-restart/">Abend Restart</a>
</li>
            
<li >
    <a href="../rtpj-exec/">Distributed SQL</a>
</li>
            
<li class="active">
    <a href="./">Lock Release</a>
</li>
            
<li >
    <a href="../sql-text/">SQL Text</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                            
<li >
    <a href="../automation_architecture/">Architecture and Design</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Help <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../help/environment-variables/">Environment Variables</a>
</li>
                            
<li >
    <a href="../../help/using-git/">Using Git/GitHub</a>
</li>
                            
<li >
    <a href="../../help/create-issue/">Creating a GitHug Issue</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../rtpj-exec/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../sql-text/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#lock-release">Lock Release</a></li>
            <li><a href="#jenkins-test-status">Jenkins Test Status</a></li>
            <li><a href="#test-parameters">Test Parameters</a></li>
        <li class="main "><a href="#json-example">JSON Example</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="lock-release">Lock Release</h1>
<p><strong>WARNING WARNING WARNING!!! This test can cause DB2 to crash</strong></p>
<p>This test type allows testing of the Detector collection engines ability to release a CML Lock that was obtained during
 interval switch building the new interval collection buckets but was not released during normal flow.</p>
<p>This is accomplished by zapping two instructions in the correct version of DT$DIU for the DB2 Version the PDT collection
will be started for. Code snippets follow:</p>
<p>1) The J and JZ instructions at offsets B9A and BA0 are found by looking for the LGR and CDSG instruction set.</p>
<pre><code>00000B8C B904 00F7                         15573+         LGR   R15,R7                       SET NEW ANCHOR ADDR        
00000B90 EB0E 6010 003E          00000010  15574+         CDSG  R0,R14,STM$SANC              INSERT NEW ENTRY           
00000B96 A774 FFF4               00000B7E  15575+         JNE   A0932                        TRY AGAIN                  
00000B9A A7F4 0005               00000BA4  15576          J     UPDT2400                                             
                                           15577 *                                                                      
00000B9E                                   15578 UPDT2350 DS    0H                                                      
00000B9E 1222                              15579          LTR   R2,R2                        DO WE HAVE LOCK         
00000BA0 A784 0009               00000BB2  15580          JZ    UPDT2450                     ..NO, THEN SKIP THIS    
</code></pre>

<p>2) The unconditional J instruction (offset B9A) is zapped to a NOP while the JZ instruction (offset BA0) is zapped to an
   unconditional J to UPDT2450 which branches around the call to DT$IURLK(i.e. BAKR at BAE) to release the CML Lock.</p>
<pre><code>B8C B904 00F7                   LGR      RW15,RW7           
B90 EB0E 6010 003E              CDSG     R0,R14,X'00010'(R6)
B96 A774 FFF4                   JNE      *-X'0018'            (PTX0004:PDTDIUC0.DT$DIUC0+B7E)
B9A 4700 0005                   NOP      X'005'                                              
B9E 1222                        LTR      R2,R2                                               
BA0 A7F4 0009                   J        *+X'0012'            (PTX0004:PDTDIUC0.DT$DIUC0+BB2)
BA4 4110 C000                   LA       R1,X'000'(,R12)                                     
BA8 E3F0 A118 0017              LLGT     RW15,X'00118'(,R10)                                 
BAE B240 000F                   BAKR     0,R15                                               
BB2 E370 C510 0024              STG      RW7,X'00510'(,R12)                                            
</code></pre>

<p>Because of the nature of this test altering code in collection engine modules that are directly execute by threads in the DB2
address space and/or modules that remain loaded for the duration of the xmanager address space. It is highly suggested that users
understand the implications of running this test on DB2 SSID's and XMANAGERS that are used by the entire development
community (i.e. xmanagers that service the PRD, DEV, QA, and CURIR environments).</p>
<h3 id="jenkins-test-status">Jenkins Test Status</h3>
<p>The table below lists the jenkins tests that are available and what the status of the last run of the test was. Click on
the status icon to go straight to jenkins for the particular build project.</p>
<table>
<thead>
<tr>
<th>Jenkins Build Name</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="test-parameters">Test Parameters</h2>
<p>The table below lists the required and optional parameters that are valid for this test. Follow the link by clicking on the
parameter name in the JSON column. If the parameter has a command line override option it will be listed in the Command Line Override
column. Additionally there are <a href="#json-example">examples</a> at the bottom of this page.</p>
<h4 id="required">Required</h4>
<table>
<thead>
<tr>
<th>JSON</th>
<th>Command Line Override</th>
<th>Special Usage or Note</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../json-parameters/#product_code">product_code</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="../json-parameters/#test_type">test_type</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="../json-parameters/#lpar">lpar</a></td>
<td><a href="../command-line-options/#lpar">lpar</a></td>
<td></td>
</tr>
<tr>
<td><a href="../json-parameters/#userid">userid</a></td>
<td><a href="../command-line-options/#userid">userid</a></td>
<td></td>
</tr>
<tr>
<td><a href="../json-parameters/#ssid">ssid</a></td>
<td><a href="../command-line-options/#ssid">ssid</a></td>
<td></td>
</tr>
<tr>
<td><a href="../json-parameters/#xman">xman</a></td>
<td><a href="../command-line-options/#xman">xman</a></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="optional">Optional</h4>
<table>
<thead>
<tr>
<th>JSON</th>
<th>Command Line Override</th>
<th>Special Usage or Note</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../json-parameters/#output_location">output_location</a></td>
<td><a href="../command-line-options/#output_location">output_location</a></td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="json-example">JSON Example</h1>
<hr />
<pre><code class="json">{
  &quot;connection&quot;:
  {
    &quot;lpar&quot;: &quot;ca11&quot;,
    &quot;userid&quot;: &quot;qartp01&quot;,
    &quot;ssid&quot;: &quot;d11c&quot;
  },
  &quot;tests&quot;:
  [
    {
      &quot;description&quot;: &quot;Zap instructions in DT$DIU so that DIU does not release the CML lock&quot;,
      &quot;test_type&quot;: &quot;lock release&quot;,
      &quot;product_code&quot;: &quot;PDT&quot;,
      &quot;environment&quot;: &quot;&quot;,
      &quot;xman&quot;: &quot;ptx0004&quot;
    }
  ]
}

</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
